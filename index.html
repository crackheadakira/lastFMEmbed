<!doctype html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./tailwind.css" rel="stylesheet" type="text/css">
    <link rel="preconnect" href="https://rsms.me/">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <title>last.FM embed editor</title>
</head>

<body class="flex h-screen items-center justify-center bg-background font-inter text-accent">
    <div id="app" class="flex h-fit w-fit flex-col items-center gap-8 p-4">
        <div id="username" class="relative flex h-fit w-full items-center justify-center">

            <svg class="absolute left-6 h-4 fill-accent" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                <path
                    d="M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512H418.3c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304H178.3z" />
            </svg>
            <input type="text"
                class="h-10 w-full appearance-none rounded-full bg-input p-4 text-center text-sm font-medium"
                placeholder="Enter last.FM user..." name="username">
        </div>
        <div id="embed_preview" class="w-full px-4">
            <h2 class="pb-1 text-left text-lg font-semibold">Preview</h2>
            <div id="embed" class="flex h-embed-h w-embed-w items-center gap-5 rounded-md bg-embedBackground px-2">
                <img id="cover" src="/22.png" class="aspect-square h-24 rounded-md"></img>
                <div id="content" class="flex w-full flex-col items-center justify-center truncate">
                    <div id="status" class="hidden text-text">Listened to</div>
                    <div id="song" class="font-medium text-text">Hooka</div>
                    <div id="artist" class="text-sm">HYUKOH</div>
                    <div id="bars" class="relative hidden h-5 w-28"></div>
                </div>
            </div>
            <div class="w-embed-w">
                <div id="cover_embed"
                    class="hidden h-embed-h w-fit items-center gap-5 rounded-md bg-embedBackground px-2">
                    <img id="cover" src="/22.png" class="aspect-square h-24 rounded-md"></img>
                </div>
            </div>
        </div>
        <div id="settings" class="w-full px-4">
            <h2 class="pb-1 text-left text-lg font-semibold">Settings</h2>
            <div class="flex flex-col gap-3 text-sm font-medium">
                <label for="previousTracks" class="flex items-center justify-between text-settingName">
                    Tracks (max 5)
                    <input class="h-8 w-input rounded-md bg-input px-3 text-text" type="number" name="previousTracks"
                        value="1" min="1" max="5">
                </label>
                <label for="showStatus" class="relative flex items-center justify-between text-settingName">
                    Show status
                    <input type="checkbox" name="showStatus"
                        class="peer absolute left-1/2 h-full w-full -translate-x-1/2 appearance-none rounded-md" />
                    <span
                        class="ml-4 flex h-8 w-input flex-shrink-0 items-center rounded-full bg-toggleOff p-1 duration-150 ease-in-out after:pointer-events-none after:h-6 after:w-6 after:rounded-full after:bg-text after:shadow-md after:duration-150 group-hover:after:translate-x-1 peer-checked:bg-primaryButton peer-checked:after:translate-x-input"></span>
                </label>
                <label for="statusBar" class="relative flex items-center justify-between text-settingName">
                    Show status as a bar
                    <input type="checkbox" name="statusBar"
                        class="peer absolute left-1/2 h-full w-full -translate-x-1/2 appearance-none rounded-md" />
                    <span
                        class="ml-4 flex h-8 w-input flex-shrink-0 items-center rounded-full bg-toggleOff p-1 duration-150 ease-in-out after:pointer-events-none after:h-6 after:w-6 after:rounded-full after:bg-text after:shadow-md after:duration-150 group-hover:after:translate-x-1 peer-checked:bg-primaryButton peer-checked:after:translate-x-input"></span>
                </label>
                <label for="transparent" class="relative flex items-center justify-between text-settingName">
                    Transparent background
                    <input type="checkbox" name="transparent"
                        class="peer absolute left-1/2 h-full w-full -translate-x-1/2 appearance-none rounded-md" />
                    <span
                        class="ml-4 flex h-8 w-input flex-shrink-0 items-center rounded-full bg-toggleOff p-1 duration-150 ease-in-out after:pointer-events-none after:h-6 after:w-6 after:rounded-full after:bg-text after:shadow-md after:duration-150 group-hover:after:translate-x-1 peer-checked:bg-primaryButton peer-checked:after:translate-x-input"></span>
                </label>
                <label for="showOnlyCover" class="relative flex items-center justify-between text-settingName">
                    Show only cover
                    <input type="checkbox" name="showOnlyCover"
                        class="peer absolute left-1/2 h-full w-full -translate-x-1/2 appearance-none rounded-md" />
                    <span
                        class="ml-4 flex h-8 w-input flex-shrink-0 items-center rounded-full bg-toggleOff p-1 duration-150 ease-in-out after:pointer-events-none after:h-6 after:w-6 after:rounded-full after:bg-text after:shadow-md after:duration-150 group-hover:after:translate-x-1 peer-checked:bg-primaryButton peer-checked:after:translate-x-input"></span>
                </label>
                <label for="showAsAlbum" class="relative flex items-center justify-between text-settingName">
                    Show album instead
                    <input type="checkbox" name="showAsAlbum"
                        class="peer absolute left-1/2 h-full w-full -translate-x-1/2 appearance-none rounded-md" />
                    <span
                        class="ml-4 flex h-8 w-input flex-shrink-0 items-center rounded-full bg-toggleOff p-1 duration-150 ease-in-out after:pointer-events-none after:h-6 after:w-6 after:rounded-full after:bg-text after:shadow-md after:duration-150 group-hover:after:translate-x-1 peer-checked:bg-primaryButton peer-checked:after:translate-x-input"></span>
                </label>
                <label for="trackColor" class="flex items-center justify-between text-settingName">
                    Track text color
                    <input class="h-8 w-input rounded-md bg-input p-2" type="color" name="trackColor" value="#FFFFFF">
                </label>
                <label for="artistColor" class="flex items-center justify-between text-settingName">
                    Artist text color
                    <input class="h-8 w-input rounded-md bg-input p-2" type="color" name="artistColor" value="#9693BD">
                </label>
                <label for="backgroundColor" class="flex items-center justify-between text-settingName">
                    Background color
                    <input class="h-8 w-input rounded-md bg-input p-2" type="color" name="backgroundColor"
                        value="#181414">
                </label>
                <label for="statusBarColor" class="flex items-center justify-between text-settingName">
                    Status bar color
                    <input class="h-8 w-input rounded-md bg-input p-2" type="color" name="statusBarColor"
                        value="#1c8b43">
                </label>
            </div>
        </div>
        <button class="h-11 w-28 rounded-md bg-primaryButton text-sm font-medium text-text">Copy URL</button>
    </div>
</body>

</html>

<script>
    const baseURL = `${window.location.href}user/`;
    const parameters = {
        previousTracks: "1",
        trackColor: "FFFFFF",
        artistColor: "9693BD",
        backgroundColor: "181414"
    };

    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', () => {
            const query = input.name;
            const value = (input.type === "checkbox" ? input.checked.toString() : input.value).replace("#", "");

            if (query === "showStatus" && input.checked) {
                document.querySelector('#status').classList.remove('hidden');
            }
            else if (query === "showStatus" && !input.checked) {
                document.querySelector('#status').classList.add('hidden');
                document.querySelector('#bars').classList.add('hidden');
            }

            if (query === "showOnlyCover" && input.checked) {
                document.querySelector('#cover_embed').classList.remove('hidden');
                document.querySelector('#embed').classList.add('hidden');
                document.querySelector('#cover_embed').classList.add('flex');
            }
            else if (query === "showOnlyCover" && !input.checked) {
                document.querySelector('#cover_embed').classList.add('hidden');
                document.querySelector('#cover_embed').classList.remove('flex');
                document.querySelector('#embed').classList.remove('hidden');
            }

            if (query === "showAsAlbum" && input.checked) {
                document.querySelector('#song').textContent = "22";
            } else if (query === "showAsAlbum" && !input.checked) {
                document.querySelector('#song').textContent = "Hooka";
            }


            if (query === "statusBar" && input.checked && parameters["showStatus"] === "true") {
                document.querySelector('#bars').classList.remove('hidden');
                document.querySelector('#bars').classList.add('flex');

                document.querySelector('#status').classList.add('hidden');
            } else if (query === "statusBar" && !input.checked && parameters["showStatus"] === "true") {
                document.querySelector('#bars').classList.add('hidden', 'flex');
                document.querySelector('#status').classList.remove('hidden');
            }

            if (query === "transparent" && input.checked) {
                document.querySelector('#embed').style.backgroundColor = "transparent";
            }
            else if (query === "transparent" && !input.checked) {
                document.querySelector('#embed').style.backgroundColor = `#${parameters["backgroundColor"]}`;
            }

            if (query === "backgroundColor")
                document.querySelector('#embed').style.backgroundColor = `#${value}`;
            if (query === "trackColor")
                document.querySelector('#song').style.color = `#${value}`;
            if (query === "artistColor")
                document.querySelector('#artist').style.color = `#${value}`;
            if (query === "statusBarColor")
                document.querySelectorAll('.animate-sound').forEach(bar => bar.style.backgroundColor = `#${value}`);

            if (query !== "username")
                parameters[query] = value;

            if (parameters[query] === "false")
                delete parameters[query];
        })
    });

    for (let i = 0; i < 30; i++) {
        const bar = document.createElement('div');
        bar.style.backgroundColor = "#1c8b43";
        bar.classList.add('bar', 'animate-sound');
        bar.style.animationDuration = `${Math.random() * (3200 - 1000) + 1000}ms`;
        bar.style.left = `${i * 4}px`;
        document.querySelector('#bars').appendChild(bar);
    }

    document.querySelector('button').addEventListener('click', () => {
        const buttonURL = `${baseURL}${document.querySelector('input[name="username"]').value}?${Object.keys(parameters).map(key => `${key}=${parameters[key]}`).join('&')}`;
        console.log(buttonURL);
        navigator.clipboard.writeText(buttonURL);
    });
</script>